"0","##Extract PC1"
"0","pcs_samples_cyt <- data.frame(cyto.all.pca_cyt$ind$coord)"
"0","df.all.sampledata.melis <- data.frame(sample_data(ps2.v1v2v3.glom.species.ra.top25))"
"0","df.all.sampledata.melis$PC1 <- pcs_samples_cyt$Dim.1"
"0","df.all.cyto.melis <- df.all.sampledata.melis[c(allCytokineColnames,""PC1"")] #subset cytokines and PC1 columns"
"0","#dt.ps1.cyto.melis <- apply(dt.ps1.cyto.melis, 2, as.numeric)"
"0","df.all.cyto.melis.scale <- scale(df.all.cyto.melis[, -ncol(df.all.cyto.melis)])"
"0","df.all.cyto.melis.scale <- cbind(df.all.cyto.melis.scale, PC1 = df.all.cyto.melis[, ncol(df.all.cyto.melis)])"
"0","# Add PC1 column to sample data for sorting"
"0","df.all.sampledata.melis$PC1 <- df.all.cyto.melis.scale[, ""PC1""]"
"0","hclust2 <- function(x,method=""complete"")  hclust (x, method=""complete"")"
"0","dist2 <- function(x,method=""manhattan"")  dist (x, method=""manhattan"")"
"0","df.all.cyto.melis.scale.t <- t(df.all.cyto.melis.scale)"
"0","## Get BV, STI and inflammation data"
"0","# BV"
"0","BV <- as.vector(df.all.sampledata.melis$bvscat)"
"0","BV <- replace(BV, which(BV == ""BV""),""white"")"
"0","BV <- replace(BV, which(BV == ""Intermediate""),""grey60"")"
"0","BV <- replace(BV, which(BV == ""Negative""),""maroon"")"
"0","#Inflammation"
"0","Infln <- as.vector(df.all.sampledata.melis$Inflammation)"
"0","Infln <- replace(Infln, which(Infln == 0),""white"")"
"0","Infln <- replace(Infln, which(Infln == 1),""maroon"")"
"0","#STI"
"0","STI <- as.vector(df.all.sampledata.melis$STI)"
"0","STI <- replace(STI, which(STI == 0),""white"")"
"0","STI <- replace(STI, which(STI == 1),""maroon"")"
"0","#Gonorrhea"
"0","gono <- as.vector(df.all.sampledata.melis$Gonorrhoea)"
"0","gono <- replace(gono, which(gono == 0),""white"")"
"0","gono <- replace(gono, which(gono == 1),""maroon"")"
"0","#Trichomoniasis"
"0","tric <- as.vector(df.all.sampledata.melis$Trichomoniasis)"
"0","tric <- replace(tric, which(tric == 0),""white"")"
"0","tric <- replace(tric, which(tric == 1),""maroon"")"
"0","#Chlamydia"
"0","chl <- as.vector(df.all.sampledata.melis$Chlamydia)"
"0","chl <- replace(chl, which(chl == 0),""white"")"
"0","chl <- replace(chl, which(chl == 1),""maroon"")"
"0","#HSV2"
"0","hsv2 <- as.vector(df.all.sampledata.melis$HSV.2)"
"0","hsv2 <- replace(hsv2, which(hsv2 == 0),""white"")"
"0","hsv2 <- replace(hsv2, which(hsv2 == 1),""maroon"")"
"0","#Candidiasis"
"0","cand <- as.vector(df.all.sampledata.melis$Candidiasis)"
"0","cand <- replace(cand, which(cand == 0),""white"")"
"0","cand <- replace(cand, which(cand == 1),""maroon"")"
"0","#CSTs"
"0","csts <- as.vector(df.all.sampledata.melis$CSTs)"
"0","csts <- replace(csts, which(csts == ""I-A""),  CSTsPallete[1])"
"0","csts <- replace(csts, which(csts == ""I-B""),  CSTsPallete[2])"
"0","csts <- replace(csts, which(csts == ""III-A""),CSTsPallete[5])"
"0","csts <- replace(csts, which(csts == ""III-B""),CSTsPallete[6])"
"0","csts <- replace(csts, which(csts == ""IV-A""), CSTsPallete[7])"
"0","csts <- replace(csts, which(csts == ""IV-B""), CSTsPallete[8])"
"0","csts <- replace(csts, which(csts == ""IV-C0""),CSTsPallete[9])"
"0","# creates a own color palette from red to green"
"0","my_palette <- colorRampPalette(c(""forestgreen"", ""yellow"", ""deeppink3""))(n = 119)"
"0","# (optional) defines the color breaks manually for a ""skewed"" color transition"
"0","col_breaks = c(seq(-3,0.0,length=30),  # for green"
"0","               seq(0.1,1.0,length=30),              # for yellow"
"0","               seq(1.1,3,length=60))              # for red"
"0","###Print them all out"
"0","myAnnotColmns <- c(""Inflammation"", ""STI"")"
"0","plotHeatmaps <- function(dataFr, dataFr2, annotColmns){"
"0","   require(gplots)"
"0","   for(i in c(1:length(annotColmns))){"
"0","    colName <- annotColmns[i]"
"0","    #Define color vector"
"0","    colVec <- as.vector(dataFr2[, colName])"
"0","    colVec <- replace(colVec, which(colVec == 0),""white"")"
"0","    colVec <- replace(colVec, which(colVec == 1),""maroon"")"
"0","    "
"0","    #Generate heatmaps"
"0","    heatmap.2(dataFr,"
"0","          main = paste0(""Heatmap with "", colName, "" annotation""),"
"0","          hclustfun = hclust2,"
"0","          distfun=dist2,"
"0","          trace=""none"",         # turns off trace lines inside the heat map"
"0","          col=my_palette,       # use on color palette defined earlier"
"0","          breaks=col_breaks,    # enable color transition at specified limits"
"0","          sepcolor=""gray70"",    # determines the separation color"
"0","          colsep=0:ncol(dataFr), # determines where column separators go"
"0","          rowsep=0:nrow(dataFr), # determines where row separators go"
"0","          sepwidth=c(0.01,0.01), # determines the width of the separators"
"0","          density.info=""none"", # turns off density plot inside color legend"
"0","          keysize = 1.5,"
"0","          labCol = FALSE, #remove column names"
"0","          ColSideColors=colVec,"
"0","          key = T"
"0","    )  "
"0","   }"
"0","}"
"0","## Plot cytokine heatmaps of all Cytokines"
"0","plotHeatmaps(df.all.cyto.melis.scale.t, df.all.sampledata.melis,  myAnnotColmns)"
"2","Loading required package: gplots
"
"2","package ‘gplots’ was built under R version 3.5.2"
"2","
Attaching package: ‘gplots’

"
"2","The following object is masked from ‘package:IRanges’:

    space

"
"2","The following object is masked from ‘package:S4Vectors’:

    space

"
"2","The following object is masked from ‘package:stats’:

    lowess

"
