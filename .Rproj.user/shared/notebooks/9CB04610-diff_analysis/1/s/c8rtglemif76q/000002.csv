"0","library(corrplot)"
"2","corrplot 0.84 loaded
"
"0","profInfC <- c(""TNF.b""  , ""IL.12p40"" , ""IL.12p70"" , ""IL.1a"" , ""IL.6"" , ""TNF.a"" , ""IL.1b"", ""IL.18"" , ""MIF"" , ""TRAIL"")"
"0","#View(data.frame(sample_data(ps2.v1v2v3.cst.glom.Species.ra)))"
"0","ps2.v1.cyto <- prune_samples(sample_data(ps2.v1v2v3.glom.species.ra)$VisitCode == 1000, ps2.v1v2v3.glom.species.ra)"
"0","ps2.v1.cyto <- prune_taxa(taxa_sums(ps2.v1.cyto) > 0, ps2.v1.cyto)"
"0","ps2.v2.cyto <- prune_samples(sample_data(ps2.v1v2v3.glom.species.ra)$VisitCode == 1020, ps2.v1v2v3.glom.species.ra)"
"0","ps2.v2.cyto <- prune_taxa(taxa_sums(ps2.v2.cyto) > 0, ps2.v2.cyto)"
"0","visit1cyto <- subset(data.frame(sample_data(ps2.v1v2v3.glom.species.ra)), VisitCode == 1000, select = c(""TNF.b""  , ""IL.12p40"" , ""IL.12p70"" , ""IL.1a"" , ""IL.6"" , ""TNF.a"" , ""IL.1b"", ""IL.18"" , ""MIF"" , ""TRAIL""))"
"0","visit2cyto <- subset(data.frame(sample_data(ps2.v1v2v3.glom.species.ra)), VisitCode == 1020, select = c(""TNF.b""  , ""IL.12p40"" , ""IL.12p70"" , ""IL.1a"" , ""IL.6"" , ""TNF.a"" , ""IL.1b"", ""IL.18"" , ""MIF"" , ""TRAIL""))"
"0","visit1cyto$PID <- as.numeric(substr(rownames(visit1cyto), 1, nchar(rownames(visit1cyto))-1))"
"0","visit2cyto$PID <- as.numeric(substr(rownames(visit2cyto), 1, nchar(rownames(visit2cyto))-1))"
"0","idsInBoth <- intersect(visit1cyto$PID, visit2cyto$PID)"
"0","visit1cyto <- visit1cyto[visit1cyto$PID %in% idsInBoth, ]"
"0","visit2cyto <- visit2cyto[visit2cyto$PID %in% idsInBoth, ]"
"0","## order by rownames of v2c"
"0","visit1cyto <- visit1cyto[with(visit2cyto, order(rownames(visit1cyto))), ]"
"0","visit12FC <- (visit2cyto - visit1cyto[with(visit2cyto, order(rownames(visit1cyto))), ])"
"0","visit12FC$PID <- NULL ##drop PID column"
"0","##V1 samples"
"0","V1_otu_tab <- data.frame(otu_table(ps2.v1.cyto))"
"0","V1_otu_tab1 <- as.data.frame(t(V1_otu_tab))"
"0","V1_otu_tab1$OTU <- rownames(V1_otu_tab1)"
"0","V1_tax_tab <- data.frame(tax_table(ps2.v1.cyto))"
"0","V1_tax_tab$OTU <- rownames(V1_tax_tab)"
"0","otuWSpeciesV1 <- merge(V1_otu_tab1, V1_tax_tab[, c(""OTU"", ""Species"")], by = ""OTU"")"
"0","otuWSpeciesV1 <- otuWSpeciesV1[, -1]"
"0","otuWSpeciesV1 <- otuWSpeciesV1[!duplicated(otuWSpeciesV1$Species),]"
"0","rownames(otuWSpeciesV1) <- otuWSpeciesV1$Species"
"0","t.otuWSpeciesV1 <- data.frame(t(otuWSpeciesV1[, -ncol(otuWSpeciesV1)]))"
"0","##V2 samples"
"0","V2_otu_tab <- data.frame(otu_table(ps2.v2.cyto))"
"0","V2_otu_tab1 <- as.data.frame(t(V2_otu_tab))"
"0","V2_otu_tab1$OTU <- rownames(V2_otu_tab1)"
"0","V2_tax_tab <- data.frame(tax_table(ps2.v2.cyto))"
"0","V2_tax_tab$OTU <- rownames(V2_tax_tab)"
"0","otuWSpeciesV2 <- merge(V2_otu_tab1, V1_tax_tab[, c(""OTU"", ""Species"")], by = ""OTU"")"
"0","otuWSpeciesV2 <- otuWSpeciesV2[, -1]"
"0","otuWSpeciesV2 <- otuWSpeciesV2[!duplicated(otuWSpeciesV2$Species),]"
"0","rownames(otuWSpeciesV2) <- otuWSpeciesV2$Species"
"0","t.otuWSpeciesV2 <- data.frame(t(otuWSpeciesV2[, -ncol(otuWSpeciesV2)]))"
"0","## resolve ids"
"0","t.otuWSpeciesV1$PID <- as.numeric(substr(rownames(t.otuWSpeciesV1), 1, nchar(rownames(t.otuWSpeciesV1))-1))"
"0","t.otuWSpeciesV2$PID <- as.numeric(substr(rownames(t.otuWSpeciesV2), 1, nchar(rownames(t.otuWSpeciesV2))-1))"
"0","## Taxa in both"
"0","taxaInBoth <- intersect(colnames(t.otuWSpeciesV1), colnames(t.otuWSpeciesV2))"
"0","t.otuWSpeciesV1 <- t.otuWSpeciesV1[t.otuWSpeciesV1$PID %in% idsInBoth, taxaInBoth]"
"0","t.otuWSpeciesV2 <- t.otuWSpeciesV2[t.otuWSpeciesV2$PID %in% idsInBoth, taxaInBoth]"
"0","##Fold Change"
"0","otuWSpeciesFC <- (t.otuWSpeciesV2 - t.otuWSpeciesV1[with(t.otuWSpeciesV2, order(rownames(t.otuWSpeciesV1))), ])"
"0","otuWSpeciesFC$PID <- NULL ##drop PID column"
"0","cyto.spec <- cbind(otuWSpeciesFC, visit12FC)"
"0","cyto.spec.pca <- PCA(scale(as.matrix(cyto.spec), center = TRUE, scale = TRUE), scale.unit = FALSE, graph = FALSE)"
"0","corrplot::corrplot(cor(otuWSpeciesFC , visit12FC), type=""full"","
"0","         p.mat = cyto.spec.pca$P, sig.level = 0.001, insig = ""blank"")"
