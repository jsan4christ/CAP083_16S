"0","## Visit2 only:"
"0","ps2.v2 <- prune_samples(sample_data(ps2.v1v2v3)$VisitCode == 1020, ps2.v1v2v3)"
"0","ps2.v2 <- prune_taxa(taxa_sums(ps2.v2) > 0, ps2.v2)"
"0","## Estimate richness"
"0","ps2.v2 <- cestimate_richness(ps2.v2)"
"2","The data you have provided does not have
any singletons. This is highly suspicious. Results of richness
estimates (for example) are probably unreliable, or wrong, if you have already
trimmed low-abundance taxa from the data.

We recommended that you find the un-trimmed data and retry."
"0","## Aglomerate to species"
"0","ps2.v2.glom.species <- tax_glom(ps2.v2, ""Species"")"
"0","## Transform to relative abundance"
"0","ps2.v2.cst.glom.species.ra <- transform_sample_counts(ps2.v2.glom.species, function(x) {"
"0","  x/sum(x)"
"0","})"
"0","## Cluster into CSTs"
"0","#ps2.v2.cst.glom.species.ra <- generate_mclust_csts(ps2.v2.glom.species.ra, nClusters = 4)"
"0","#Sort by CTS snd Shannon indexes before proceeding"
"0","sample_data(ps2.v2.cst.glom.species.ra) <- sample_data(ps2.v2.cst.glom.species.ra)[order(sample_data(ps2.v2.cst.glom.species.ra)$sim_CST, sample_data(ps2.v2.cst.glom.species.ra)$ShannonLgT), ]"
"0","#Reorganise factors to known CT naming convention"
"0","#cstLevels <- c(""CST1"", ""CST3"", ""CST2"",""CST4"") #as.vector(unique(sample_data(ps2.v1.cst.glom.Species.ra)$CSTs))"
"0","#cstLabels <- c(""CST1"", ""CST2"", ""CST3"", ""CST4"")"
"0","#sample_data(ps2.v2.cst.glom.species.ra)$CSTs <- factor(sample_data(ps2.v2.cst.glom.species.ra)$CSTs, levels = cstLevels, labels = cstLabels)"
"0","#levels(sample_data(ps2.v2.cst.glom.species.ra)$CSTs)"
"0","ps2.v2.cst.glom.species.ra <- prune_samples(sample_sums(ps2.v2.cst.glom.species.ra) > 0, ps2.v2.cst.glom.species.ra)"
"0","ps2.v2.cst.glom.species.ra <- prune_taxa(taxa_sums(ps2.v2.cst.glom.species.ra) > 0, ps2.v2.cst.glom.species.ra)"
"0","  "
"0","# Elbow method"
"0","fviz_nbclust(as.matrix(phyloseq::distance(ps2.v2.cst.glom.species.ra, method=""bray"")), kmeans, method = ""wss"") +"
"0","    geom_vline(xintercept = 4, linetype = 2)+"
"0","  labs(subtitle = ""Elbow method"")"
