"0","# Prevalence estimation"
"0","# Calculate feature prevalence across the data set. i.e all the samples in which an ASV is found"
"0","df.ps0.prevalence <- apply(X = otu_table(ps0.phylum.bact), MARGIN = ifelse(taxa_are_rows(ps0.phylum.bact), yes = 1, no = 2), FUN = function(x){sum(x > 0)})"
"0","message(""Maximum prevalence: "", max(df.ps0.prevalence), ""\n"")"
"0","message(""Minimum prevalence: "", min(df.ps0.prevalence), ""\n"")"
"0"," "
"0","# Add taxonomy and total read counts (all sequences from a sample) to df.prevalence"
"0","df.ps0.prevalence <- data.frame(Prevalence = df.ps0.prevalence, TotalAbundance = taxa_sums(ps0.phylum.bact), tax_table(ps0.phylum.bact))"
"0","#Prevalence plot"
"0","df.ps0.prevalence.phylum <- subset(df.ps0.prevalence, Phylum %in% get_taxa_unique(ps0.phylum.bact, ""Phylum""))"
"0","gg.ps0.prevalence <- ggplot(df.ps0.prevalence.phylum, aes(TotalAbundance, Prevalence / nsamples(ps0.phylum.bact), color=Family)) +"
"0","  geom_hline(yintercept = 0.05, alpha = 0.8, linetype = 2) +"
"0","  geom_point(size = 3, alpha = 0.8) +"
"0","  scale_x_log10() +"
"0","  xlab(""Total Abundance"") + ylab(""Prevalence [Frac. Samples]"") +"
"0","  facet_wrap(~Phylum) +"
"0","  theme(legend.position=""none"") +"
"0","  ggtitle(""Phylum Prevalence in All Samples\nColored by Family"")"
"0","gg.ps0.prevalence"
