"0","# Remove specific taxa "
"0","#get_taxa_unique(ps1, ""Phylum"")"
"0","# Define a list with taxa to remove. Acidobacteria does not really occur humans so we will drop"
"0","#filterPhyla = c( ""[Thermi]"", ""Chloroflexi"", ""Synergistetes"", ""Verrucomicrobia"", ""Spirochaetes"", ""Nitrospirae"", ""SR1"", ""TM7"")"
"0","#filterSpecies <- c(""Peptoniphilus harei"")"
"0","#filterPhyla"
"0","#ps1.prevalence <- subset_taxa(ps1, !(Phylum %in% filterPhyla | Species %in% filterSpecies))"
"0","#ps1.prevalence <- subset_taxa(ps1, !(Phylum %in% filterPhyla))"
"0","#get_taxa_unique(ps1.prevalence, ""Phylum"")"
"0","# Removing taxa that fall below 5% prevelance"
"0","# Define the prevalence threshold"
"0","prevalenceThreshold = 0.05 * nsamples(ps0.phylum.bact)"
"0","prevalenceThreshold"
"1","[1]"
"1"," 19.6"
"1","
"
"0","# Define which taxa fall within the prevalence threshold"
"0","keepTaxa <- rownames(df.ps0.prevalence.phylum)[(df.ps0.prevalence.phylum$Prevalence >= prevalenceThreshold)]"
"0","length(keepTaxa)"
"1","[1]"
"1"," 263"
"1","
"
"0","ntaxa(ps0.phylum.bact)"
"1","[1]"
"1"," 9548"
"1","
"
"0","# Remove those taxa"
"0","ps1 <- prune_taxa(keepTaxa, ps0.phylum.bact)"
"0","ntaxa(ps1)"
"1","[1]"
"1"," 263"
"1","
"
"0","# Calculate feature prevalence across the data set. i.e all the samples in which an ASV is found"
"0","df.ps1.prevalence <- apply(X = otu_table(ps1), MARGIN = ifelse(taxa_are_rows(ps1), yes = 1, no = 2), FUN = function(x){sum(x > 0)})"
"0","cat(""Maximum prevalence: "", max(df.ps1.prevalence), ""\n"")"
"1","Maximum prevalence: "
"1"," "
"1","127"
"1"," "
"1","
"
"0","cat(""Minimum prevalence: "", min(df.ps1.prevalence), ""\n"")"
"1","Minimum prevalence: "
"1"," "
"1","20"
"1"," "
"1","
"
"0"," "
"0","# Add taxonomy and total read counts (all sequences from a sample) to df.prevalence"
"0","df.ps1.prevalence <- data.frame(Prevalence = df.ps1.prevalence, TotalAbundance = taxa_sums(ps1), tax_table(ps1))"
"0","#Prevalence plot"
"0","df.ps1.prevalence.phylum <- subset(df.ps1.prevalence, Phylum %in% get_taxa_unique(ps1, ""Phylum""))"
"0","gg.ps1.prevalence <- ggplot(df.ps1.prevalence.phylum, aes(TotalAbundance, Prevalence / nsamples(ps1), color=Family)) +"
"0","  geom_hline(yintercept = 0.05, alpha = 0.8, linetype = 2) +"
"0","  geom_point(size = 3, alpha = 0.8) +"
"0","  scale_x_log10() +"
"0","  xlab(""Total Abundance"") + ylab(""Prevalence [Frac. Samples]"") +"
"0","  facet_wrap(~Phylum) +"
"0","  theme(legend.position=""none"") +"
"0","  ggtitle(""Phylum Prevalence in All Samples\nColored by Family"")"
"0","gg.ps1.prevalence"
