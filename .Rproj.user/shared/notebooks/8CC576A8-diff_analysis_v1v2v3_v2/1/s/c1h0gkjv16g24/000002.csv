"0","library(ggrepel)"
"0","library(VennDiagram)"
"0","library(ggpubr)"
"0","require(plotly)"
"0","require(RColorBrewer)"
"0","require(gridExtra )"
"0","require(FactoMineR )"
"0","library(ggsn)"
"0","#Custom color pallete for the bar plots"
"0","customPalette <- c(""Atopobium vaginae""=""#3366cc"", "
"0","                   ""g_Aerococcus""=""#666699"", "
"0","                   ""g_Anaerococcus""=""cadetblue1"", "
"0","                   ""Gardnerella vaginalis""=""#E41A1C"", "
"0","                   ""Lactobacillus crispatus""=""#33cc66"","
"0","                   ""Lactobacillus iners""=""#ffcc66"", "
"0","                   ""Lactobacillus jensenii 1""=""#009966"","
"0","                   ""Other""=""#996699"", "
"0","                   ""g_Gemella""=""#ff6699"", "
"0","                   ""g_Lactobacillus""=""#996633"", "
"0","                   ""g_Parvimonas""=""#3F78B0"", "
"0","                   ""g_Fastidiosipila""=""#3B889F"", "
"0","                   ""g_Peptostreptococcus""=""#ff6600"", "
"0","                   ""f_Bifidobacteriaceae""=""#cc99cc"", "
"0","                   ""g_Dialister""=""#cc6666"", "
"0","                   ""Sneathia sanguinegens""=""#993366"", "
"0","                   ""Prevotella bivia""=""#ffff33"", "
"0","                   ""g_Sneathia""=""#ccffff"","
"0","                   ""Sneathia amnii""=""#66cccc"","
"0","                   ""Peptostreptococcus anaerobius""=""#cccccc"","
"0","                   ""g_Streptococcus""=""black"","
"0","                   ""g_DNF00809""=""#006633"","
"0","                   ""Megasphaera massiliensis""=""#ff9933"","
"0","                   ""BVAB1""=""#ff00ff"","
"0","                   ""Lactobacillus gasseri""=""#663366"","
"0","                   ""g_Peptoniphilus""=""#999900"","
"0","                   ""Gemella bergeri""=""#99ffff"","
"0","                   ""Mycoplasma hominis""=""#9933cc"","
"0","                   ""Prevotella amnii""=""#336699"","
"0","                   ""g_Mobiluncus""=""#336699"","
"0","                   ""Lactobacillus kitasatonis""=""#99ff00"","
"0","                   ""Lactobacillus jensenii 3""=""#ff6600"","
"0","                   ""g_Bradyrhizobium""=""#006666"","
"0","                   ""g_Escherichia/Shigella"" =""#999966"","
"0","                   ""g_Megasphaera""=""#ffcc99"","
"0","                   ""g_Prevotella""=""#99ccff"""
"0","                   "
"0","                   "
"0","                   "
"0",")"
"0","## Create dataset of participants followed accross all three visits"
"0","#ps0.phylum.bact <- subset_samples(ps0.phylum.bact, !ParticipantID == 120010)"
"0","keyTaxa <- c(""Atopobium_vaginae"", ""Gardnerella_vaginalis"", ""Lactobacillus_crispatus_Lactobacillus_helveticus"", ""Lactobacillus_iners"", ""Prevotella_bivia"", ""Prevotella_amnii"", ""BVAB1"", ""Sneathia_sanguinegens"")"
"0","keyCytokines <- c(""G.CSF"", ""IL.1a"", ""IL.1b"", ""M.CSF"")"
"0","trendingCytokines <- c(""G.CSF"", ""IL.1a"", ""IL.1b"", ""M.CSF"", ""VEGF"", ""GM.CSF"", ""HGF"", ""IL.2Ra"", ""IL.4"", ""LIF"", ""MIG"", ""TNF.a"", ""TNF.b"", ""IL.16"", ""IL.15"", ""IL.6"", ""IL.7"", ""IL.8"", ""IFN.g"", ""IL.12p70"", ""IP.10"", ""MIP.1a"", ""SCF"")"
"0","#Extract sample data"
"0","sample.data.ps1 <- data.frame(sample_data(ps1))"
"0","#Get visit 2 and 3 ids"
"0","visit1.ids <- sample.data.ps1 %>% subset(VisitCode == 1000) %>% pull('ParticipantID')"
"0","visit1.ids <- visit1.ids[!visit1.ids %in% c(120117, 120016, 120060, 120221, 120229, 120223, 120010)]"
"0","visit2.ids <- sample.data.ps1 %>% subset(VisitCode == 1020) %>% pull('ParticipantID') "
"0","visit3.ids <- sample.data.ps1 %>% subset(VisitCode == 1030) %>% pull('ParticipantID')"
"0","#IDs of followed samples"
"0","ids.v2.not.in.v1 <-  subset(visit2.ids, !visit2.ids %in% visit1.ids)"
"0","ids.v2.not.in.v3 <-  subset(visit2.ids, !visit2.ids %in% visit3.ids)"
"0","ids.v3.not.in.v1 <-  subset(visit3.ids, !visit3.ids %in% visit1.ids)"
"0","ids.v3.not.in.v2 <-  subset(visit3.ids, !visit3.ids %in% visit2.ids)"
"0","#All missing visit 1 from visit 2 and 3"
"0","ids.missing.visit1  <-  c(ids.v2.not.in.v1, ids.v3.not.in.v1)"
"0","all.missing <- unique(c(ids.missing.visit1, ids.v3.not.in.v2, ids.v2.not.in.v3))"
"0","ids.followed.v2v3 <- unique(c(visit2.ids, visit3.ids))"
"0","#visit 1, 2 and 3 intersections"
"0","v1v2.ids <- unique(subset(sample.data.ps1, ParticipantID %in% visit1.ids & ParticipantID %in% visit2.ids) %>% "
"0","                      pull('ParticipantID'))"
"0","v1v3.ids <- unique(subset(sample.data.ps1, ParticipantID %in% visit1.ids & ParticipantID %in% visit3.ids) %>% "
"0","                      pull('ParticipantID'))"
"0","v2v3.ids <- unique(subset(sample.data.ps1, ParticipantID %in% visit2.ids & ParticipantID %in% visit3.ids) %>% "
"0","                      pull('ParticipantID'))"
"0","##Get dataset with followed samples"
"0","ps2.v1v2v3 <- subset_samples(ps1, (sample_data(ps1)$ParticipantID %in% ids.followed.v2v3 & "
"0","                               !sample_data(ps1)$ParticipantID %in% all.missing))"
"0","ps2.v1v2v3"
"1","phyloseq-class experiment-level object"
"1","
"
"1","otu_table()   OTU Table:         [ 1351 taxa and 168 samples ]"
"1","
"
"1","sample_data() Sample Data:       [ 168 samples by 79 sample variables ]"
"1","
"
"1","tax_table()   Taxonomy Table:    [ 1351 taxa by 7 taxonomic ranks ]"
"1","
"
"1","phy_tree()    Phylogenetic Tree: [ 1351 tips and 1349 internal nodes ]"
"1","
"
"0","#Samples followed through the 3 times"
"0","ps2.v1v2v3.ids <- unique(sample_data(ps2.v1v2v3)$ParticipantID)"
"0","saveRDS(ps2.v1v2v3.ids, ""results/v1v2v3-ids.txt"")"
"0","sample_data(ps2.v1v2v3)$VisitCode <- factor(sample_data(ps2.v1v2v3)$VisitCode, levels = c(1000, 1020, 1030))"
"0","#IDs present in visit 1, 2 and 3"
"0","ids.followed.v1v2v3 <- unique(sample_data(ps2.v1v2v3)$ParticipantID)"
"0","ids.followed.v1v2v3 <- c(ids.followed.v1v2v3) #Plus non bv ids"
"0","#Draw venn diagram of visit distribution "
"0","draw.triple.venn(area1 = length(visit1.ids), area2 = length(visit2.ids), area3 = length(visit3.ids), n12 = length(v1v2.ids), n23 = length(v2v3.ids), n13 =length(v1v3.ids), n123 = length(ids.followed.v1v2v3), category = c(""Visit1"", ""Visit2"", ""Visit3""), lty = ""blank"", fill = c(""skyblue"", ""pink1"", ""mediumorchid""), cex=2, cat.cex = 2, cat.fontfamily = rep(""serif"", 3))"
"1","(polygon[GRID.polygon.19678], polygon[GRID.polygon.19679], polygon[GRID.polygon.19680], polygon[GRID.polygon.19681], polygon[GRID.polygon.19682], polygon[GRID.polygon.19683], text[GRID.text.19684], text[GRID.text.19685], text[GRID.text.19686], text[GRID.text.19687], text[GRID.text.19688], text[GRID.text.19689], text[GRID.text.19690], text[GRID.text.19691], text[GRID.text.19692], text[GRID.text.19693])"
"1"," "
"1","
"
"0","sample_data(ps2.v1v2v3)$bv.persisted <- 0"
"0","sample_data(ps2.v1v2v3)$bv.recurred  <- 0"
"0","sample_data(ps2.v1v2v3)$bv.cleared   <- 0"
"0","ps2.v1v2v3.f <- ps2.v1v2v3"
