"0","sig.cyto.cleared <- c(""TNF.a"", ""IL.1b"", ""LIF"", ""GM.CSF"", ""IL.8"") ## CLEARANCE"
"0","sig.cyto.persisted <- c(""LIF"", ""IL.7"", ""MCP.1"", ""IP.10"", ""MIF"", ""IL.18"", ""IL.1a"") ## PERSISTENCE"
"0","sig.cyto.recurred <- c(""M.CSF"", ""IFN.g"", ""IL.2Ra"", ""TNF.b"", ""MIF"", ""IL.18"", ""MCP.3"") ## RECURRENT"
"0","## cleared in visit 2 cytokines and taxa"
"0","##sample_data(ps2.v1v2v3.f)$bv.cleared <- ifelse(((sample_data(ps2.v1v2v3.f)$VisitCode == 1000) &"
"0","##                                                  (sample_data(ps2.v1v2v3.f)$bvscat %in% c(""Intermediate"", ""BV""))))"
"0","# sample_data(ps2.v1.cst.glom.Species.ra)$bv.persisted <- 0"
"0","# sample_data(ps2.v2.cst.glom.Species.ra)$bv.persisted <- 0"
"0","# sample_data(ps2.v3.cst.glom.Species.ra)$bv.persisted <- 0"
"0","# "
"0","# sample_data(ps2.v1.cst.glom.Species.ra)$bv.recurred <- 0"
"0","# sample_data(ps2.v2.cst.glom.Species.ra)$bv.recurred <- 0"
"0","# sample_data(ps2.v3.cst.glom.Species.ra)$bv.recurred <- 0"
"0","##Get the ids"
"0","pids <- sample_data(ps2.v1.cst.glom.species.ra)$ParticipantID"
"0","##Remove extra ids in 2 and 3"
"0","ps2.v2.cst.glom.species.ra <- subset_samples(ps2.v2.cst.glom.species.ra, sample_data(ps2.v2.cst.glom.species.ra)$ParticipantID %in% pids)"
"0","ps2.v2.cst.glom.species.ra <- prune_taxa(taxa_sums(ps2.v2.cst.glom.species.ra) > 0, ps2.v2.cst.glom.species.ra)"
"0","ps2.v3.cst.glom.species.ra <- subset_samples(ps2.v3.cst.glom.species.ra, sample_data(ps2.v3.cst.glom.species.ra)$ParticipantID %in% pids)"
"0","ps2.v3.cst.glom.species.ra <- prune_taxa(taxa_sums(ps2.v3.cst.glom.species.ra) > 0, ps2.v3.cst.glom.species.ra)"
"0","sd_wide <- data.frame(cbind(sample_data(ps2.v1.cst.glom.species.ra), sample_data(ps2.v2.cst.glom.species.ra), sample_data(ps2.v3.cst.glom.species.ra)))"
"0","#sd_wide$bv.cleared.1[ sd_wide$bvscat.1 == ""Negative""] <- 1"
"0","#table(sd_wide$bv.cleared.1)"
"0","#sd_wide$bv.cleared.2[ (sd_wide$bvscat.1 %in% c(""Intermediate"", ""BV"") & sd_wide$bvscat.2 == ""Negative"")] <- 1"
"0","sd_wide$bv.cleared.2[ (sd_wide$bvscat.2 == ""Negative"")] <- 1"
"0","table(sd_wide$bv.cleared.2)"
"1","
"
"1"," 0 "
"1"," 1 "
"1","
"
"1","43 "
"1","13 "
"1","
"
"0","sd_wide$bv.persisted.2[ (sd_wide$bvscat.1 %in% c(""Intermediate"", ""BV"") & sd_wide$bvscat.2 %in% c(""Intermediate"", ""BV""))] <- 1"
"0","table(sd_wide$bv.persisted.2)"
"1","
"
"1"," 0 "
"1"," 1 "
"1","
"
"1","29 "
"1","27 "
"1","
"
"0","sd_wide$bv.recurred.2[ (sd_wide$bvscat.1  == ""Negative"" & sd_wide$bvscat.2 %in% c(""Intermediate"", ""BV""))] <- 1"
"0","table(sd_wide$bv.recurred.2)"
"1","
"
"1"," 0 "
"1"," 1 "
"1","
"
"1","40 "
"1","16 "
"1","
"
"0","sdv1 <- sd_wide[,c(1:86)]"
"0","sdv2 <- sd_wide[,c(87:172)]"
"0","names(sdv2) <- names(sdv1)"
"0","sdv3 <- sd_wide[,c(173:258)]"
"0","names(sdv3) <- names(sdv1)"
"0","##83 to 164 - v2, 165 to 246 - v3 //start end in wide dataset"
"0","sdv1v2v3 <- rbind(sdv1, sdv2, sdv3)"
"0","#View(sdv1v2v3)"
"0","bv.cleared.ids <- (sdv1v2v3[sdv1v2v3$bv.cleared == 1, ])$SampleID"
"0","#ps2.v1v2v3.f.glomSpecies <- tax_glom(ps2.v1v2v3.cst.glom.species.ra, taxrank = ""Species"")"
"0","ps2.cleared.cyto <- subset_samples(ps2.v1v2v3.glom.species.ra, sample_data(ps2.v1v2v3.glom.species.ra)$SampleID %in% bv.cleared.ids)"
"0","ps2.cleared.cyto <- subset_taxa(ps2.cleared.cyto, Species %in% keyTaxa)"
"2","prune_taxa attempted to reduce tree to 1 or fewer tips.
 tree replaced with NULL."
"0","ps2.cleared.cyto <- prune_taxa(taxa_sums(ps2.cleared.cyto) >0, ps2.cleared.cyto)"
"0","taxa_names(ps2.cleared.cyto) <- tax_table(ps2.cleared.cyto)[, ""Species""]"
"0","otu.ps2.cleared.cyto <- data.frame(otu_table(ps2.cleared.cyto))"
"0","# Reformat species column names so they are easier to follow"
"0","#SpeciesColNames <- colnames(otu.ps2.cleared.cyto)"
"0","#SpeciesColNamesSplit <- t(data.frame(stri_split_fixed(str = SpeciesColNames, pattern = ""."", n = 2)))"
"0","#SpeciesColNamesFmt <- paste0(substr(SpeciesColNamesSplit[, 1], 1,1),""."", SpeciesColNamesSplit[, 2])"
"0","#colnames(otu.ps2.cleared.cyto) <-  SpeciesColNamesFmt"
"0","df.ps2.cleared.cyto <- data.frame(sample_data(ps2.cleared.cyto)[, c(sig.cyto.cleared)])"
"0","dt.ps2.cleared.cyto.otu <- cbind(otu.ps2.cleared.cyto, df.ps2.cleared.cyto)"
"0","dt.ps2.cleared.pca <- PCA(scale(as.matrix(dt.ps2.cleared.cyto.otu), center = TRUE, scale = TRUE), scale.unit = FALSE, graph = FALSE)"
"0","fviz_pca_biplot(dt.ps2.cleared.pca,"
"0","             #individuals "
"0","             geom.ind = ""point"", # show points only (but not ""text""),"
"0","             habillage = (data.frame(sample_data(ps2.cleared.cyto)))$sim_CST,"
"0","             col.var = ""black"", "
"0","             arrowsize=1,"
"0","             "
"0","             #variables"
"0","             alpha.var =  ""cos2"", "
"0","             #addEllipses = TRUE, # Concentration ellipses"
"0","             #ellipse.level=0.95,"
"0","             palette = CSTsPallete,"
"0","             legend.title = ""sim_CST"","
"0","             title = ""PCA plot Showing the Relationship Between Bacteria and Cytokines Significant in the Cleared Category"","
"0","             repel = TRUE) +"
"0","  scale_color_brewer(palette=""Dark2"")+ "
"0","  theme_minimal(base_size = 14) +"
"0","  theme(text = element_text(face = ""bold""))"
"2","Scale for 'colour' is already present. Adding another scale for 'colour', which will replace the existing scale.
"
