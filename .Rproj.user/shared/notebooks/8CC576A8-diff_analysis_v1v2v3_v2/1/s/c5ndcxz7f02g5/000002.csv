"0","#library(ggplot2)"
"0","#library(phyloseq)"
"0","#library(data.table)"
"0","#data(GlobalPatterns)"
"0","# Remove OTUs not 3 greater than 3"
"0","#keepTaxa = apply(X = as(otu_table(GlobalPatterns), ""matrix"") > 3L,"
"0","#                 MARGIN = 1, FUN = sum) >= 3L"
"0","#phy = prune_taxa(keepTaxa, GlobalPatterns)"
"0","# get abundance in %"
"0","#phy <- transform_sample_counts(ps2.v2.cst.glom.Species.ra, function(x) x/sum(x))"
"0","# agglomerate taxa"
"0","#glom <- tax_glom(phy, taxrank = 'Species')"
"0","# create dataframe from phyloseq object"
"0","ps2.v2.cst.merged <-merge_less_than_top(ps2.v2.cst.glom.species.ra, 2)"
"0","dat <- data.table(psmelt(ps2.v2.cst.merged))"
"0","# convert Phylum to a character vector from a factor because R"
"0","dat$Species <- as.character(dat$Species)"
"0","# group dataframe by Phylum, calculate median rel. abundance"
"0","dat <- dat[, median := median(Abundance, na.rm = TRUE), by = ""Phylum""]"
"0","# Change name to remainder of Phylum less than 1%"
"0","#dat[(median <= 0.0001), Species := ""Others""]"
"0","#sort samples by CSTs and Abundance"
"0","dat <- dat[order(sim_subCST, Abundance), ]"
"0","dat$ParticipantID <- as.character(dat$ParticipantID)"
"0","# boxplot"
"0","ggplot(dat[Abundance > 0],"
"0","       aes(x=Species,"
"0","           y=Abundance)) + "
"0","  geom_boxplot() + "
"0","  coord_flip() +"
"0","  scale_y_log10()"
