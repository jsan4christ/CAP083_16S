"0","## Visit3 only:"
"0","ps2.v3 <- prune_samples(sample_data(ps2.v1v2v3)$VisitCode == 1030, ps2.v1v2v3)"
"0","ps2.v3 <- prune_taxa(taxa_sums(ps2.v3) > 0, ps2.v3)"
"0","## Estimate richness"
"0","ps2.v3 <- cestimate_richness(ps2.v3)"
"0","## Transform to relative abundance"
"0","ps2.v3.cst.ra <- transform_sample_counts(ps2.v3, function(x) {"
"0","  x/sum(x)"
"0","})"
"0","otu_table(ps2.v3.cst.ra)[is.nan(otu_table(ps2.v3.cst.ra))] <- 0"
"0","## Aglomerate to species"
"0","ps2.v3.cst.glom.species.ra <- tax_glom(ps2.v3.cst.ra, ""Species"")"
"0","##otu_table(ps2.v3.cst.glom.species.ra) <- otu_table(ps2.v3.cst.glom.species.ra) + 1"
"0","## Cluster into CSTs"
"0","#ps2.v3.cst.glom.species.ra <- generate_mclust_csts(ps2.v3.glom.species.ra, nClusters = 4)"
"0","#Reorganise factors to known CT naming convention"
"0","#cstLevels <- c(""CST3"", ""CST4"", ""CST1"", ""CST2"") #as.vector(unique(sample_data(ps2.v1.cst.glom.Species.ra)$CSTs))"
"0","#cstLabels <- c(""CST1"", ""CST2"", ""CST3"", ""CST4"")"
"0","#sample_data(ps2.v3.cst.glom.species.ra)$CSTs <- factor(sample_data(ps2.v3.cst.glom.species.ra)$CSTs, levels = cstLevels, labels = cstLabels)"
"0","#levels(sample_data(ps2.v3.cst.glom.species.ra)$CSTs)"
"0","#Sort by CTS snd Shannon indexes before proceeding"
"0","sample_data(ps2.v3.cst.glom.species.ra) <- sample_data(ps2.v3.cst.glom.species.ra)[order(sample_data(ps2.v3.cst.glom.species.ra)$sim_subCST, sample_data(ps2.v3.cst.glom.species.ra)$ShannonLgT), ]"
"0","dist_obj <- as.matrix(phyloseq::distance(ps2.v3.cst.glom.species.ra, method=""bray""))"
"2","you have empty rows: their dissimilarities may be meaningless in method “bray”"
"2","missing values in results"
"0","dist_obj[is.na(dist_obj)] <- 0"
"0","dist_obj[is.nan(dist_obj)] <- 0 "
"0","# Elbow method"
"0","fviz_nbclust(dist_obj, kmeans, method = ""wss"") +"
"0","    geom_vline(xintercept = 4, linetype = 2)+"
"0","  labs(subtitle = ""Elbow method"")"
